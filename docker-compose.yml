services:
  claude-sandbox:
    build: .
    image: claude-sandbox

    # Mount ONLY the target project - nothing else from host
    volumes:
      - ${PROJECT_PATH:-.}:/workspace
      # Persist Claude config via bind mount to host (not named volume!)
      - ${CLAUDE_SANDBOX_CONFIG}:/claude
      # Mount host Claude config read-only for skills/commands
      - ${HOME}/.claude:/host-claude:ro

    # Full internet access (required for Claude API)
    network_mode: bridge

    # Interactive terminal
    stdin_open: true
    tty: true

    # Environment
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}
      - TERM=xterm-256color
      - HOME=/home/coder
      - CLAUDE_CONFIG_DIR=/claude

    # Resource limits (optional, adjust as needed)
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '4'


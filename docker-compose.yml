services:
  claude-sandbox:
    build: .
    image: claude-sandbox

    # Mount ONLY the target project - nothing else from host
    volumes:
      - ${PROJECT_PATH:-.}:/workspace
      # Persist Claude settings/auth between runs
      - claude-config:/home/coder/.claude
      - claude-config-local:/home/coder/.config/claude

    # Full internet access (required for Claude API)
    network_mode: bridge

    # Interactive terminal
    stdin_open: true
    tty: true

    # Environment
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      - GIT_USER_NAME=${GIT_USER_NAME:-}
      - GIT_USER_EMAIL=${GIT_USER_EMAIL:-}
      - TERM=xterm-256color

    # Resource limits (optional, adjust as needed)
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '4'

volumes:
  claude-config:
  claude-config-local:
